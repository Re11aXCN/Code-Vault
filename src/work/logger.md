### 日志系统执行流程详解：

1. **初始化阶段**：
   ```mermaid
   graph TD
     A[创建Logger实例] --> B[打开日志文件]
     B --> C[启动消费者线程]
     C --> D[线程进入等待状态]
   ```

2. **日志记录阶段**：
   ```mermaid
   graph TD
     A[调用log方法] --> B[格式化日志消息]
     B --> C[消息推入LogQueue]
     C --> D[唤醒消费者线程]
     D --> E[消费者线程获取消息]
     E --> F[添加时间戳]
     F --> G[写入文件并刷新]
   ```

3. **关闭阶段**：
   ```mermaid
   graph TD
     A[Logger析构] --> B[关闭LogQueue]
     B --> C[通知消费者线程]
     C --> D[处理剩余所有日志]
     D --> E[消费者线程退出]
     E --> F[关闭日志文件]
   ```

### 关键组件说明：

1. **LogQueue** - 线程安全队列：
   - 使用互斥锁(`mutex`)保护队列操作
   - 条件变量(`condition_variable`)实现生产-消费模型
   - `atomic<bool>`确保关闭标志的线程安全

2. **Logger** - 日志核心：
   - 生产者接口：`log()`方法格式化并提交日志
   - 消费者线程：持续处理队列中的日志
   - 自动时间戳：精确到毫秒的本地时间
   - 文件管理：RAII模式确保资源释放

3. **多线程协作**：
   - 生产者（主线程/工作线程）：调用`log()`提交日志
   - 消费者（专用线程）：处理日志写入
   - 无锁队列减少竞争，条件变量优化CPU使用

这个实现确保了：
- 线程安全的日志记录
- 精确到毫秒的时间戳
- 异常安全的资源管理
- 程序退出时所有日志都会被写入
- 高效的异步I/O操作