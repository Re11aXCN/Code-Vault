OpenGL或湿卡中的统一变量是什么，统一变量是个非常单的概念，它们基本上对于我们来说，就是一种方式为了实际上从CPU端获取数据，在我们之前的例子中就是着色器



对比熟悉和统一变量

你确实必须知道的比较大的区别就是，统一变量是设置每次绘制的，在你调用glDrawElements或glDrawArrays,之前



color写死了，我们想给cpu内设置统一变量

`uniform vec4 u_Color`

![image-20240701192322954](C:\Users\Re11a\Desktop\c++资料\ChernoOpenGL-master\notes\assets\image-20240701192322954.png)



![image-20240701192502341](C:\Users\Re11a\Desktop\c++资料\ChernoOpenGL-master\notes\assets\image-20240701192502341.png)

```cpp
ShaderProgramSource source = ParseShader("res/shaders/Basic.shader");
	uint32_t shader = CreateShader(source.VertexSource, source.FragmentSource);
	GLCall(glUseProgram(shader));

	// 获取着色器实际颜色变量的位置
	int location;
	GLCall(location = glGetUniformLocation(shader, "u_Color"));
	ASSERT(location != -1);
	// 设置颜色数据
	GLCall(glUniform4f(location, 0.2f, 0.3f, 0.8f, 1.0f));

	while (!glfwWindowShouldClose(window))
```

### 统一变量——颜色变化

```cpp
	glfwMakeContextCurrent(window);

	glfwSwapInterval(1); //限制刷新速率

	if (glewInit() != GLEW_OK)
	{
		std::cout << "Error!\n";
	}

	// 获取着色器实际颜色变量的位置
	int location;
	GLCall(location = glGetUniformLocation(shader, "u_Color"));
	ASSERT(location != -1);
	// 设置颜色数据
	GLCall(glUniform4f(location, 0.8f, 0.3f, 0.8f, 1.0f));

	float red = 0.0f;
	float increment = 0.05f;
	while (!glfwWindowShouldClose(window))
	{
		glClear(GL_COLOR_BUFFER_BIT);

		GLCall(glUniform4f(location, red, 0.3f, 0.8f, 1.0f));
		GLCall(glDrawElements(GL_TRIANGLES, 6, GL_UNSIGNED_INT, nullptr));

		if (red > 1.0f) increment = -0.05f;
		else if (red < 0.0f) increment = 0.05f;
		red += increment;

		glfwSwapBuffers(window);
		glfwPollEvents();
	}
```

### 详细说明

```cpp
// 在GPU上的数据
const char* vertexShaderSource = "#version 330 core\n"
"layout (location = 0) in vec3 aPos;\n"
//"out vec4 vertexColor;\n"
"void main()\n"
"{\n"
"   gl_Position = vec4(aPos.x, aPos.y, aPos.z, 1.0f);\n"
//"   vertexColor = vec4(0.5, 0.0, 0.0, 1.0);\n"
"}\0";

const char* fragmentShaderSource = "#version 330 core\n"
"out vec4 FragColor;\n"
//"in vec4 vertexColor;\n"
"uniform vec4 u_Color;\n" // CPU向GPU传数据——统一变量
"void main()\n"
"{\n"
"   FragColor = u_Color;\n"
"}\0";
```

`"out vec4 vertexColor;\n"`和`"in vec4 vertexColor;\n"`都是写死在GPU当中的，我们想要实现自定义颜色，需从CPU传数据给GPU，shader中关键字为**==uniform==**

==`"uniform vec4 u_Color;\n"`称之为统一变量==

CPU及CPP代码中需要给程序绑定变量名字，然后传RGBA

```cpp
	// 省略其他代码
	/* 着色器程序设置链接 */
	unsigned int program = glCreateProgram();
	glAttachShader(program, vertexShader);
	glAttachShader(program, fragmentShader);
	glLinkProgram(program);
	CheckProgramLinkStatus(&program);
	glUseProgram(program);
	// 省略其他代码
	/* 给程序 绑定 统一变量 后 设置颜色*/
	int vec4Colorlocation = glGetUniformLocation(program, "u_Color");
	glUniform4f(vec4Colorlocation, 0.5f, 0.0f, 0.0f, 1.0f);

	while (!glfwWindowShouldClose(window))
    {
        
    }
```

